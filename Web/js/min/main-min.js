"use strict";function rng(i,t){return Math.floor(Math.random()*(t-i))+i}function drawFPS(){context.font="20px Verdana",context.fillStyle="black",context.fillText(Math.floor(fps)+"FPS",10,30)}function AnimateSprite(i,t,e,n,s,o,r,a,g,p){tickCount[g]||(tickCount[g]=0),frame[g]||(frame[g]=0),tickCount[g]===t&&(tickCount[g]=0),context.drawImage(i,n*tickCount[g],0,s,n,r,a,n*o,s*o),frame[g]>=e&&(tickCount[g]++,frame[g]=0),p||frame[g]++}function drawImageSprite(i,t,e,n){context.drawImage(i,0,0,i.width,i.height,t,e,i.width*n,i.height*n)}function loopSprite(i,t,e,n,s,o,r){var a=i.width,g=i.height;loop[s]||(loop[s]=[]);for(var p=0;r>p;p++){loop[s][p]||(loop[s][p]=0);var d=a*t*p+loop[s][p];drawImageSprite(i,d,n,t,a,g),context.fillStyle="#ff8800",context.fillRect(d,0,10,canvas.height),-a*t>d&&(loop[s][p]=a*t*3),loop[s][p]--}}function moveSprite(i,t,e,n,s,o){loop[s]||(loop[s]=0);var r=i.width,a=i.height,g=e-loop[s]*(o/100);drawImageSprite(i,g,n,t,r,a),-r*t>g&&(loop[s]=-(r*t+canvas.width+100)),loop[s]++}function fill(i,t,e){var n=Math.floor(canvas.width/i.width*t)+1;n==1/0&&(n=20);for(var s=0;n>s;s++)drawImageSprite(i,i.width*t*s,e,t)}function draw(){0===bitking.sprite&&(bitking.sprite=sprites.bitKingLeft),context.beginPath(),(pressedKeys[keyCodes.a]||pressedKeys[keyCodes.ArrowLeft])&&(bitking.x-=bitking.speed,bitking.sprite=sprites.bitKingLeft),(pressedKeys[keyCodes.d]||pressedKeys[keyCodes.ArrowRight])&&(bitking.sprite=sprites.bitKingRight,bitking.x+=bitking.speed),(pressedKeys[keyCodes.d]||pressedKeys[keyCodes.a]||pressedKeys[keyCodes.ArrowRight]||pressedKeys[keyCodes.ArrowLeft])&&!bitking.isJumping||(bitking.sprite==sprites.bitKingLeft&&(bitking.sprite=sprites.bitKingIdleLeft),bitking.sprite==sprites.bitKingRight&&(bitking.sprite=sprites.bitKingIdleRight)),(pressedKeys[keyCodes.space]||pressedKeys[keyCodes.w]||pressedKeys[keyCodes.ArrowUp])&&!bitking.isJumping&&(bitking.isJumping=!0,console.log("jumping")),bitking.isJumping&&(bitking.vy++,bitking.vy<bitking.jumpHeight/10*bitking.jumpHeight/2&&(bitking.velosity-=bitking.baseVelosity/bitking.jumpHeight),bitking.vy>bitking.jumpHeight/10*bitking.jumpHeight/2&&(bitking.velosity+=bitking.baseVelosity/bitking.jumpHeight),bitking.vy>=bitking.jumpHeight?bitking.y+=bitking.speed*bitking.velosity:bitking.y-=bitking.speed*bitking.velosity,bitking.y>bitking.baseY&&(bitking.isJumping=!1,bitking.vy=0,bitking.velosity=bitking.baseVelosity),bitking.y>bitking.baseY&&(bitking.y=bitking.baseY)),context.clearRect(0,0,canvas.width,canvas.height),context.fillStyle="#7ec0ee",context.fillRect(0,0,canvas.width,canvas.height),drawFPS(),drawImageSprite(sprites.fjell2,0,-30,5),drawImageSprite(sprites.fjell1,0,200,5),moveSprite(sprites.cloud1,5,500,-20,2,10),moveSprite(sprites.cloud2,5,700,50,3,20),moveSprite(sprites.cloud3,5,900,20,4,30),fill(sprites.dirt,2,canvas.height-2*sprites.dirt.height),AnimateSprite(sprites.fireHouse,10,5,299,299,3,canvas.width/2-448.5,canvas.height-500,0,!1),fill(sprites.gress,3,canvas.height-160),AnimateSprite(bitking.sprite,8,5,62,60,3,bitking.x,bitking.y,1,bitking.move),fill(sprites.gress,3,canvas.height-135),context.closePath(),context.fill()}function animate(){requestAnimFrame(animate);var i=(Date.now()-timeFPS)/1e3;timeFPS=Date.now(),fps=1/i,draw()}function drawLoadingScreen(){context.beginPath(),context.fillStyle="#7ec0ee",context.fillRect(0,0,canvas.width,canvas.height),context.fillStyle="#222222",context.font="40px areal",context.fillText("Loading...",canvas.width/2-75,canvas.height/2-50),context.fillStyle="#f8f8f8",context.fillRect(canvas.width/2-200,canvas.height/2-25,400,50),context.fillStyle="#222222",context.fillRect(canvas.width/2-200,canvas.height/2-25,400/totalSprites*spriteBarCount,50),context.closePath()}function loadGame(){spriteCount--,spriteBarCount++,drawLoadingScreen(),0===spriteCount&&animate()}function init(){context=canvas.getContext("2d"),context.imageSmoothingEnabled=!1,context.mozImageSmoothingEnabled=!1,document.body.appendChild(canvas),drawLoadingScreen();for(var i in sprites)if(sprites.hasOwnProperty(i)){var t=new Image;t.src=sprites[i],sprites[i]=t,sprites[i].addEventListener("load",loadGame)}bitking.y=bitking.baseY}var timeFPS=Date.now(),fps=0;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i,t){window.setTimeout(i,1e3/60)}}();var canvas,context,tickCount=[],frame=[],loop=[],sprites={fjell2:"img/fjell2.png",fjell1:"img/fjell1.png",gress:"img/gress2.png",fireHouse:"img/fire/fire.png",bitKingRight:"img/bitking/bitking.png",bitKingLeft:"img/bitking/bitkingLeft.png",bitKingIdleLeft:"img/bitking/bitkingIdleLeft.png",bitKingIdleRight:"img/bitking/bitkingIdleRight.png",cloud1:"img/cloud1.png",cloud2:"img/cloud2.png",cloud3:"img/cloud3.png",dirt:"img/dirt.png"};canvas=document.createElement("canvas"),canvas.width=window.innerWidth,canvas.height=window.innerHeight;var keyCodes={w:87,s:83,a:65,d:68,esc:27,enter:13,space:32,ArrowDown:40,ArrowRight:39,ArrowUp:38,ArrowLeft:37},pressedKeys={},bitking={x:0,y:0,sprite:0,speed:8,move:!1,velosity:0,baseVelosity:2.8,vy:0,baseY:canvas.height-260,isJumping:!1,jumpHeight:20};document.addEventListener("keydown",function(i){pressedKeys[i.keyCode]=!0}),document.addEventListener("keyup",function(i){pressedKeys[i.keyCode]=!1});var spriteCount=0,totalSprites=0,spriteBarCount=0;for(var key in sprites)sprites.hasOwnProperty(key)&&(spriteCount++,totalSprites++);init();